<!DOCTYPE html>
<html>
  <title>Nangaku Building</title>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      /*changing asthetics (MERGER)*/
      body {
          font-family: "Raleway", sans-serif;
          font-weight: normal;
          font-style: normal;
      }
      /* side bar itself */
      .sidenav {
          height: 100%;
          width: 0;
          position: fixed;
          z-index: 1;
          top: 0;
          right: 0;
          background-color: rgb(160, 186, 195);
          overflow-x: hidden;
          transition: .75s;
          padding-top: 30px;
      }
      /* title at top */
      g
      {
        font-size: 36px;
        padding: 0px 3px 0px 7px;
        color: #ffffff;
        margin-bottom: 20px;
      }

      /*asthetic rectangle*/
      .rectangle {
        position: absolute;
        left: 10px;
        height: 10px;
        width: 136px;
        align: left;
        background-color: #ffffff;
      }

      button {
        position: absolute;
        height: 0px;
        width: 0px;
      }

      /* list of events */
      .sidenav a {
          /* space between (top, right side, bottom, left side )*/
          padding: 20px 5px 0px 10px;
          text-decoration: none;
          font-size: 24px;
          color: #ffffff;
          display: block;
          transition: 0.5s;
          line-height: 1em;
          margin-top: 10px;

      }

      .dropdown-container{
        display:none;
      }

      /* color of text after hover*/
      .sidenav a:hover {
          color: #000000;
      }

      /* close sidebar button */
      .sidenav .closebtn {
          position: absolute;
          top: 0;
          right: 10px;
          font-size: 36px;
          margin-left: 50px;
      }

      p
      /* what opens after clicking on an event */
      {
        font-size: 18px;
        padding-left: 35px;
        padding-right: 3px;
        padding-top: 0px;
        padding-bottom: 0px;
        color: #818181;
      }

      /*text specific for directions */
      .sidenav b {
          padding: 0px 5px 35px 35px;
          text-decoration: bold;
          font-size: 18px;
          color: #818181;
          display: block;
          transition: 0.3s;
      }
      /* color of text after hover*/
      .sidenav b:hover {
          color: #f1f1f1;
      }

      #main {
          transition: margin-left .5s;
          padding: 16px;
      }

      @media screen and (max-height: 450px) {
        .sidenav {padding-top: 15px;}
        .sidenav a {font-size: 18px;}
      }
    </style>
  </head>

<body>

  <div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>

  <g> EVENTS </g>

  <div class="rectangle"></div>

  <div class="button">
    <button id="authorize_button" style="display: none;">Authorize</button>
    <button id="signout_button" style="display: none;">Sign Out</button>
  </div>

  <pre id="content" style="white-space: pre-wrap;"></pre>

  <a class="dropdown-btn"> <div id ="event1"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time1"></p>
    <p id ="location1"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id="event2"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time2"></p>
    <p id ="location2"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id="event3"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time3"></p>
    <p id ="location3"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id ="event4"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time4"></p>
    <p id ="location4"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id="event5"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time5"></p>
    <p id ="location5"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id="event6"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time6"></p>
    <p id ="location6"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id ="event7"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time7"></p>
    <p id ="location7"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id="event8"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time8"></p>
    <p id ="location8"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id="event9"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time9"></p>
    <p id ="location9"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id ="event10"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time10"></p>
    <p id ="location10"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id="event11"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time11"></p>
    <p id ="location11"></p>
    <b href="#">Directions</b>
  </div>

  <a class="dropdown-btn"> <div id="event12"></div>
    <i class="fa fa-caret-down"></i>
  </a>
  <div class="dropdown-container">
    <p id ="time12"></p>
    <p id ="location12"></p>
    <b href="#">Directions</b>
  </div>

  <script>
    var dropdown = document.getElementsByClassName("dropdown-btn");
    var i;
    for (i = 0; i < dropdown.length; i++) {
      dropdown[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var dropdownContent = this.nextElementSibling;
        if (dropdownContent.style.display === "none") {
          dropdownContent.style.display = "block";
        } else {
          dropdownContent.style.display = "none";
        }
      });
    }
  </script>


  <script type="text/javascript">

    // Client ID and API key from the Developer Console
    var CLIENT_ID = '838924599001-deoloebt602et97hrlajsd29lmllnmpq.apps.googleusercontent.com';
    var API_KEY = 'AIzaSyDiUHhA9rZuyJyhTN5hjVPkwOQaCnC4zX4';

    // Array of API discovery doc URLs for APIs used by the quickstart
    var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];

    // Authorization scopes required by the API; multiple scopes can be
    // included, separated by spaces.
    var SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

    var authorizeButton = document.getElementById('authorize_button');
    var signoutButton = document.getElementById('signout_button');
    //var xhr = new XMLHttpRequest();
    //xhr.open('GET', "https://www.googleapis.com/calendar/v3/calendars/acg4tehdnkv29rfpasrt7eo1kb81qv0l%40import.calendar.google.com/events?timeMax=2019-01-17T23%3A59%3A59Z&key={AIzaSyAbfHCvJAxKTcbFHJBtLjTdbiwKoq93vmc)", true);
    //xhr.send();
    /**
     *  On load, called to load the auth2 library and API client library.
     */
     var finalAthleticTitle = new Array();
     var finalAthleticLocation = new Array();
     var finalAthleticTimeD = new Array();
     var finalAthleticTimeH = new Array();
     var finalAthleticTimeM = new Array();
     var finalAthleticTimeYear = new Array();
     var finalAthleticTimeMonth = new Array();
     var finalAthleticTimeDay = new Array();
     var finalAthleticEndTimeH = new Array();
     var finalAthleticEndTimeM = new Array();

     var finalSchoolTitle = new Array();
     var finalSchoolLocation = new Array();
     var finalSchoolTimeD = new Array();
     var finalSchoolTimeH = new Array();
     var finalSchoolTimeM = new Array();
     var finalSchoolTimeYear = new Array();
     var finalSchoolTimeMonth = new Array();
     var finalSchoolTimeDay = new Array();
     var finalSchoolEndTimeH = new Array();
     var finalSchoolEndTimeM = new Array();

     var finalTitle = new Array();
     var finalLocation = new Array();
     var finalTimeD = new Array();
     var finalTimeH = new Array();
     var finalTimeM = new Array();
     var finalEndTimeH = new Array();
     var finalEndTimeM = new Array();

     var sPlace = 0;
     var aPlace = 0;

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    /**
     *  Initializes the API client library and sets up sign-in state
     *  listeners.
     */
    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(function () {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = handleAuthClick;
        signoutButton.onclick = handleSignoutClick;
      }, function(error) {
        appendPre(JSON.stringify(error, null, 2));
      });
    }

    /**
     *  Called when the signed in status changes, to update the UI
     *  appropriately. After a sign-in, the API is called.
     */
    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        //signoutButton.style.display = 'block';
        listAthleticEvents();
        //listUpcomingEvents();
        //compileList();
      } else {
        authorizeButton.style.display = 'block';
        //signoutButton.style.display = 'none';
      }
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    /*
     Sign out the user upon button click.
     */
    /*
    function handleSignoutClick(event) {
      gapi.auth2.getAuthInstance().signOut();
    }
    */

    /**
     * Append a pre element to the body containing the given message
     * as its text node. Used to display the results of the API call.
     *
     * @param {string} message Text to be placed in pre element.
     */
    function appendPre(message) {
      var pre = document.getElementById('content');
      var textContent = document.createTextNode(message + '\n');
      pre.appendChild(textContent);
    }

    /**
     * Print the summary and start datetime/date of the next ten events in
     * the authorized user's calendar. If no events are found an
     * appropriate message is printed.
     */
     //ATHLETIC EVENTS CALENDAR
     function listAthleticEvents() {
      gapi.client.calendar.events.list({
        'calendarId': 'ianftid1id99ndghk76k7fpab92vih89@import.calendar.google.com',
        'timeMin': (new Date()).toISOString(),
        'showDeleted': false,
        'singleEvents': true,
        'maxResults': 200,
        'orderBy': 'startTime'
      }).then(function(response) {

        //final refined list to send to sidebar
        var aevents = response.result.items;
        //appendPre('Athletic events:');
        if (aevents.length > 0) {
          // if there are events on calendar execute to add space
          for (j = 0; j < aevents.length; j++) {
            var athletic = aevents[j];
            athletic.summary = athletic.summary + ' ';
            //appendPre(athletic.summary);
          }
          for (i = 0; i < aevents.length; i++) {
            var athletic = aevents[i];
            var awhen = athletic.start.dateTime;
            var aendwhen = athletic.end.dateTime;

            var today = (new Date()).toISOString();
            // grab the date of the instant it reloads and compare it to the date of the event
            var dateOnly = today.substring(8, 10);
            // take event's date and start time
            if (!awhen) {
              awhen = athletic.start.date;
            }
            // separate date, minutes, and seconds individually
            var startYear = awhen.substring(0, 4);
            var startMonth = awhen.substring (5, 7);
            var startDay = awhen.substring (8, 10);
            var startDate;
            var startMin = awhen.substring (14, 16);
            var startSec = awhen.substring (17, 19);

            var endHours = aendwhen.substring (11, 13);
            var endMin = aendwhen.substring (14, 16);
            endHours = endHours - 10;
            if (endHours < 0) {
              endHours = endHours + 24;
            }
            // SWITCH TIMEZONES FROM UTC TO HST
            // get hours
            // add 10 hours to the time
            var startHours;
            startHours = awhen.substring (11, 13);

            // switch hours from UTC to HST
            startHours = startHours - 10;
            if (startHours < 0) {
              startHours = startHours + 24;
              startDay = startDay - 1;
            }
            startDate = startYear + '-' + startMonth + '-' + startDay;
            // if today's date matches the event's date, print event
            if (dateOnly == startDay){
              // HSt is behind a day, so add 24 hours to get correct displayed hours
              startHours = startHours + 10;
              //appendPre(athletic.summary + ' (' + startDate + 'T' + startHours + ':' + startMin + ':' + startSec + 'Z' + ')' + ' (' + athletic.location + ')');
              if (athletic.location == 'Iolani' || athletic.location == "Ala Wai") {
                finalAthleticTitle[aPlace] = athletic.summary;
                finalAthleticLocation[aPlace] = athletic.location;
                finalAthleticTimeD[aPlace] = startDate;
                finalAthleticTimeH[aPlace] = startHours;
                finalAthleticTimeM[aPlace] = startMin;
                finalAthleticTimeYear[aPlace] = startYear;
                finalAthleticTimeMonth[aPlace] = startMonth;
                finalAthleticTimeDay[aPlace] = startDay;
                finalAthleticEndTimeH[aPlace] = endHours;
                finalAthleticEndTimeM[aPlace] = endMin;

                //appendPre(finalAthleticTitle[aPlace] + ' (' + finalAthleticTimeMonth[aPlace] + '-' + finalAthleticTimeDay[aPlace] + '-' + finalAthleticTimeYear[aPlace] + ')' + ' (' + finalAthleticTimeH[aPlace] + ':' + finalAthleticTimeM[aPlace] + ')' + '(' + finalAthleticLocation[aPlace] + ')' );
                aPlace = aPlace + 1;
              }
            }
          }
        }
        listUpcomingEvents();
      });
    }
    function listUpcomingEvents() {
      gapi.client.calendar.events.list({
        'calendarId': 'acg4tehdnkv29rfpasrt7eo1kb81qv0l@import.calendar.google.com',
        'timeMin': (new Date()).toISOString(),
    //    'timeMax': (new Date())
        'showDeleted': false,
        'singleEvents': true,
        'maxResults': 200,
        'orderBy': 'startTime'
      }).then(function(response) {
        var events = response.result.items;
        //imported array
        var checker = '';
        //placeholder to check individual words
        /*var omitTitle = new Array();
        var omitLocation = new Array("A-101", "A-102", "A-201", "A-202", "A-203", "Art Gallery",
                                     "C-100", "C-101", "C-102", "C-103", "C-104", "C-105", "C-106", "C-107", "C-108", "C-109", "C-110",
                                     "C-200", "C-201", "C-202", "C-203", "C-204", "C-205", "C-206", "C-207", "C-208", "C-209", "C-210",
                                     "G-101", "G-102", "Lower Gym", "Lower", "LG", "US Dance Room", "G-201", "G-202", "G-203", "Wrestling Room", "Upper Gym", "Upper", "UG",
                                     "I-101", "I-101L", "I-102", "I-102L", "I-103", "I-104", "I-105", "I-106", "I-107", "I-108", "I-109", "Writing Center", "I-110", "I-111", "ITS", "IT", "I-112",
                                     "I-201A", "I-201B", "I-202A", "I-202B", "I-203", "I-204", "I-205", "I-206", "I-207", "I-208", "I-209", "I-210", "I-211", "I-212", "I-213", "I-214", "I-215", "I-216", "I-217",
                                     "N-201", "N-202", "N-203", "N-204", "N-205", "N-206", "N-207", "N-208", "N-209", "N-210", "N-211",
                                     "R-101", "R-102",
                                     "SCIL-1", "SAO", "Student Activities Office", "Student Actvity Office", "Fab Lab", "Fabrication Lab", "I-Lab", "I Lab", "Ka'i Office", "Kai Office", "Senior Benches", "Sr. Benches",
                                     "SCIL-2", "Library", "Archives",
                                     "SCIL-3", "3", "SCIL-3 CC", "CC", "SCIL-3 Seminar Room", "SCIL-3 SR", "SR",
                                     "SCIL-4", "4", "SCIL-4 CSC", "CSC", "SCIL-4 DDS", "DDS", "SCIL-4 Wetlab", "Wetlab", "Wet lab",
                                     "W-101", "W-102", "W-103", "W-104", "W-105", "W-106", "College Counseling Office", "CCO", "College Counseling",
                                     "W-201", "W-202", "W-203", "W-204", "W-205", "W-206", "W-207", "W-208", "W-209", "W-210", "W-211", "W-212", "W-213", "W-214", "W-215", "W-216",
                                     "W-301", "W-302", "W-303", "W-304", "W-305", "W-306", "W-307", "W-308", "W-309", "W-310", "W-311", "W-312", "W-313", "W-314", "W-315", "W-316",
                                     "Seto Hall", "Seto", "Seto Hall Lanai", "Seto Lanai",
                                     "Student Center", "SC", "Cafeteria", "Fac. Lounge", "Faculty Lounge", "Kitchen",
                                     "Pool", "Dillingham Pool",
                                     "Football Field", "Track", "Soccer Field", "Kozuki Stadium", "Press Box",
                                     "Chapel", "St. Alban's Chapel",
                                     "Center Courtyard");*/

        //varibles to check event with
        //appendPre('');
        //appendPre('School Events:');

        if (events.length > 0) {
          // if there are events on calendar execute
          for (j = 0; j < events.length; j++) {
            var school = events[j];
            school.summary = school.summary + ' ';
            //appendPre(school.summary);
          }
          // create a space between each event
          for (i = 0; i < events.length; i++) {
            // run through every event in list
            var school = events[i];
            // "event" variable is the current event in the array
            for (u = 0; u < school.summary.length; u++) {
              // variable u to run through characters of each event
              checker = checker + school.summary[u];
              //appendPre(checker);
              // placeholder variable that contains all current characters for loop when through
              if (school.summary[u] == ' ' || u >= school.summary.length) {
                // if it encounters a space
                if (checker == 'Trip ' || checker == 'Faculty ' || checker == 'Assembly ' || checker == 'US ' || checker == 'TIAA ' || checker == 'IAA ' || checker == 'Admission ') {
                  //if the word reads any of the above words, erase summary
                  school.summary = '';
                  school.location = '';
                }
                checker = '';
                // set placeholder back to blank for next word if there is one
              }
            }
            if (!school.location) {
              // if the event has no location, delete array portion
              school.summary = '';
              school.start.dateTime = '';
              school.location = '';
            }

            if (school.location != '' && school.summary != '') {
              //appendPre(school.summary);
              // if the event has a location and summary keep
              var when = school.start.dateTime;
              var today = (new Date()).toISOString();
              // grab the date of the instant it reloads and compare it to the date of the event
              var dateOnly = today.substring(8, 10);
              // take event's date and start time
              if (!when) {
                // if there is no start time, put date for all day event
                when = school.start.date;
              }

              //appendPre(finalSchoolTitle[i] + ' ' +  ' (' + finalSchoolTime[i] + ')' + ' (' + finalSchoolLocation[i] + ') ');
              // print the event
              var startYear = when.substring(0, 4);
              var startMonth = when.substring (5, 7);
              var startDay = when.substring (8, 10);
              var startDate;
              var startMin = when.substring (14, 16);
              var startSec = when.substring (17, 19);

              var endHours = aendwhen.substring (11, 13);
              var endMin = aendwhen.substring (14, 16);
              endHours = endHours - 10;
              if (endHours < 0) {
                endHours = endHours + 24;
              }
              // SWITCH TIMEZONES FROM UTC TO HST
              // get hours
              // add 10 hours to the time
              var startHours;
              startHours = when.substring (11, 13);

              //if (startHours > 0 && startHours < 34 && startDay == dateOnly) {
              //  startDay = startDay - 1;
              //}
              // switch hours from UTC to HST
              startHours = startHours - 10;
              if (startHours < 0) {
                startHours = startHours + 24;
                startDay = startDay - 1;
              }
              startDate = startYear + '-' + startMonth + '-' + startDay;
              // if today's date matches the event's date, print event
              //appendPre(school.summary + ' (' + startDate + 'T' + startHours + ':' + startMin + ':' + startSec + 'Z' + ')' + ' (' + school.location + ')');
              if (dateOnly == startDay){
                // HSt is behind a day, so add 24 hours to get correct displayed hours
                //appendPre(school.summary + ' (' + startDate + 'T' + startHours + ':' + startMin + ':' + startSec + 'Z' + ')' + ' (' + school.location + ')');
                if (school.location != '') {
                  finalSchoolTitle[sPlace] = school.summary;
                  finalSchoolLocation[sPlace] = school.location;
                  finalSchoolTimeD[sPlace] = startDate;
                  finalSchoolTimeH[sPlace] = startHours;
                  finalSchoolTimeM[sPlace] = startMin;
                  finalSchoolTimeYear[sPlace] = startYear;
                  finalSchoolTimeMonth[sPlace] = startMonth;
                  finalSchoolTimeDay[sPlace] = startDay;
                  finalSchoolEndTimeH[sPlace] = endHours;
                  finalSchoolEndTimeM[sPlace] = endMin;
                  //appendPre(finalSchoolTitle[sPlace] + ' (' + finalSchoolTimeMonth[sPlace] + '-' + finalSchoolTimeDay[sPlace] + '-' + finalSchoolTimeYear[sPlace] + ')' + ' (' + finalSchoolTimeH[sPlace] + ':' + finalSchoolTimeM[sPlace] + ')' + '(' + finalSchoolLocation[sPlace] + ')' );
                  sPlace = sPlace + 1;
                }
            }
          }
        }
        } else {
          appendPre('No upcoming events found.');
        }
        var today = new Date();
        //appendPre(today.getMonth());
        compileList();
      });
    }

    function compileList() {
      //appendPre(today);
      //appendPre("");
      //appendPre("COMPLIED LIST:");
      var a = 0;
      var s = 0;

      for (i = 0; i < sPlace; i++) {
        //appendPre(finalSchoolTitle[i] + ' ' +  ' (' + finalSchoolTimeD[i] + ' ' + finalSchoolTimeH[i] + ':' + finalSchoolTimeM[i] + ') (' + finalSchoolLocation[i] + ') ');
      }

      //appendPre("");

      for (i = 0; i < aPlace; i++) {
        //appendPre(finalAthleticTitle[i] + ' ' +  ' (' + finalAthleticTimeD[i] + ' ' + finalAthleticTimeH[i] + ':' + finalAthleticTimeM[i] + ') (' + finalAthleticLocation[i] + ') ');
      }

      //appendPre("");

      for (i = 0; i < 200; i++) {
        //when there is no school events remaining to be sorted
        //console.log("Comparing: " + finalSchoolTimeYear[s] + " " + finalAthleticTimeYear[a]);
        //console.log("Comparing: " + finalSchoolTimeMonth[s] + " " + finalAthleticTimeMonth[a]);
        //console.log("Comparing: " + finalSchoolTimeDay[s] + " " + finalAthleticTimeDay[a]);
        //console.log("Comparing: " + finalSchoolTimeH[s] + " " + finalAthleticTimeH[a]);
        //console.log("Comparing: " + finalSchoolTimeM[s] + " " + finalAthleticTimeM[a]);
        if (finalSchoolTitle[s] == null && finalAthleticTitle[a] != null) {
            finalTimeD[i] = finalAthleticTimeD[a];
            finalTimeH[i] = finalAthleticTimeH[a];
            finalTimeM[i] = finalAthleticTimeM[a];
            finalTitle[i] = finalAthleticTitle[a];
            finalLocation[i] = finalAthleticLocation[a];
            finalEndTimeH[i] = finalAthleticEndTimeH[a];
            finalEndTimeM[i] = finalAthleticEndTimeM[a];
            a = a + 1;
            //console.log("Athletic Event, no school");
            //appendPre("Placing remaining athletic event: " + finalTitle[i]);
        }
        //when there is no athletic events remaining to be sorted
        else if (finalAthleticTitle[a] == null && finalSchoolTitle[s] != null) {
          finalTimeD[i] = finalSchoolTimeD[s];
          finalTimeH[i] = finalSchoolTimeH[s];
          finalTimeM[i] = finalSchoolTimeM[s];
          finalTitle[i] = finalSchoolTitle[s];
          finalLocation[i] = finalSchoolLocation[s];
          finalEndTimeH[i] = finalSchoolEndTimeH[s];
          finalEndTimeM[i] = finalSchoolEndTimeM[s];
          s = s + 1;
          //console.log("School Event, no athletic");
          //appendPre("Placing remaining school event: " + finalTitle[i]);
        }
        //when school event is before athletic event
        else if ((finalSchoolTimeYear[s] <= finalAthleticTimeYear[a]) &&
            (finalSchoolTimeMonth[s] <= finalAthleticTimeMonth[a]) &&
            (finalSchoolTimeDay[s] <= finalAthleticTimeDay[a]) &&
            (finalSchoolTimeH[s] <= finalAthleticTimeH[a])) {
          //appendPre("compare school");
          finalTimeD[i] = finalSchoolTimeD[s];
          finalTimeH[i] = finalSchoolTimeH[s];
          finalTimeM[i] = finalSchoolTimeM[s];
          finalTitle[i] = finalSchoolTitle[s];
          finalLocation[i] = finalSchoolLocation[s];
          finalEndTimeH[i] = finalSchoolEndTimeH[s];
          finalEndTimeM[i] = finalSchoolEndTimeM[s];
          s = s + 1;
          //console.log("School Event, yes athletic");
          //appendPre("s: " + s);
        }
        //when athletic event is before school event
        else if (finalAthleticTitle[a] != null && finalSchoolTitle[s] != null) {
          //appendPre("compare athletic");
          finalTimeD[i] = finalAthleticTimeD[a];
          finalTimeH[i] = finalAthleticTimeH[a];
          finalTimeM[i] = finalAthleticTimeM[a];
          finalTitle[i] = finalAthleticTitle[a];
          finalLocation[i] = finalAthleticLocation[a];
          finalEndTimeH[i] = finalAthleticEndTimeH[a];
          finalEndTimeM[i] = finalAthleticEndTimeM[a];
          a = a + 1;
          console.log("Athletic Event, yes school");
          //appendPre("a: " + a);
        }
        //when all events are done
        else if (finalAthleticTitle[i] == null && finalSchoolTitle[i] == null) {
          //appendPre("FINAL LIST:");
          console.log("DONE");
          for (c = 0; c < i; c++) {
            if (finalTimeH[c] > 13) {
              finalTimeH[c] = (finalTimeH[c] - 12) + ':' + finalTimeM[c] + ' p.m.';
            }
            else {
              finalTimeH[c] = finalTimeH[c] + ':' + finalTimeM[c] + ' a.m.';
            }
            if (finalTimeM[c] == '') {

              finalTimeH[c] = 'ALL DAY';
              finalTimeM[c] = '';
            }
            //appendPre(finalTitle[c] + ' ' +  ' (' + finalTimeD[c] + ' ' + finalTimeH[c] + ':' + finalTimeM[c] + ') (' + finalLocation[c] + ') ');



            //listing all the events
            for (var i = 0; i < finalTitle.length; i++){
              var firstEvent = "event" + i;
              var secondEvent = "event" + (i + 1);
              var newEvent = firstEvent.replace(firstEvent.toString(),secondEvent.toString());
              document.getElementById(newEvent).innerHTML = finalTitle[i];
            }

            //listing all the locations
            for (var i = 0; i < finalLocation.length; i++){
              var firstLocation = "location" + i;
              var secondLocation = "location" + (i + 1);
              var newLocation = firstLocation.replace(firstLocation.toString(),secondLocation.toString());
              document.getElementById(newLocation).innerHTML = finalLocation[i];
            }

            //listing all the times
            for (var i = 0; i < finalTimeH.length; i++){
              var firstTime = "time" + i;
              var secondTime = "time" + (i + 1);
              var newTime = firstTime.replace(firstTime.toString(),secondTime.toString());
              document.getElementById(newTime).innerHTML = finalTimeH[i];
            }



          }
          i = 200;
        }
      }
    }
  </script>

  <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>

  <script>
  /*
    //array for list of events
    var listEvent = ["hello", "trash", "landis"];
    var events = listEvent.length;

    //listing all the events
    for (var i = 0; i < events; i++){
      var firstEvent = "event" + i;
      var secondEvent = "event" + (i + 1);
      var newEvent = firstEvent.replace(firstEvent.toString(),secondEvent.toString());
      document.getElementById(newEvent).innerHTML = listEvent[i];
    }
*/
    //array for list of times that corrospond with events
    var listTime = ["300", "5000", "3424"];
    var times = listTime.length;

    //listing all the times
    for (var i = 0; i < times; i++){
      var firstTime = "time" + i;
      var secondTime = "time" + (i + 1);
      var newTime = firstTime.replace(firstTime.toString(),secondTime.toString());
      document.getElementById(newTime).innerHTML = listTime[i];
    }
  /*
    //array for list of locations that corrospond with events and time
    var listLocation = ["farvdaraec", "afvfcervaer", "caervaerv"];
    var locations = listLocation.length;

    //listing all the locations
    for (var i = 0; i < locations; i++){
      var firstLocation = "location" + i;
      var secondLocation = "location" + (i + 1);
      var newLocation = firstLocation.replace(firstLocation.toString(),secondLocation.toString());
      document.getElementById(newLocation).innerHTML = listLocation[i];
    }
  */
  </script>

<script>
  //width of sidebar
  function openNav() {
    document.getElementById("mySidenav").style.width = "500px";
    document.getElementById("main").style.marginRight = "500px";
  }
  function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
    document.getElementById("main").style.marginLRight= "0";
  }

      </script>

        <script src="js/three.js"></script>
        <script src="js/controls/OrbitControls.js"></script>
        <script src="js/loaders/GLTFLoader.js"></script>
        <script src="js/shaders/CopyShader.js"></script>
        <script src="js/shaders/FXAAShader.js"></script>
        <script src="js/postprocessing/EffectComposer.js"></script>
        <script src="js/postprocessing/RenderPass.js"></script>
        <script src="js/postprocessing/ShaderPass.js"></script>
        <script src="js/postprocessing/OutlinePass.js"></script>
        <script src="js/libs/stats.min.js"></script>
        <script src='js/libs/dat.gui.min.js'></script>
        <script src='js/NameList.js'></script>
        <div id = 'canvas'>
          <script>
          // https://stackoverflow.com/questions/13542175/three-js-ray-intersect-fails-by-adding-div/13544277#13544277

          // heap clears frequently, nodes do not

          // use this function to interact with JavaScript from sidebar interaction
          const changeText = () => {}

        // declaring big boy variables
        var t;
        var container, stats;
        var camera, scene, renderer, controls;
        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2();
        var selectedObjects = [];
        var composer, effectFXAA, outlinePass;
        var group = new THREE.Group();
        var obj3d = new THREE.Object3D();
        var clips;
        var mixer = new THREE.AnimationMixer();
        var clock = new THREE.Clock(true);
        var divWidth = window.innerWidth * 3 / 4;// / 2;//500;
        var divHeight = window.innerHeight * 5 / 7// / 2;//500;
        var xd = 1;
        var yd = 1;
        var xx = 0;
        var yy = 0;
        init();
        onWindowResize();
        animate();

        function init()
        {
          //startClosed();

        container = document.getElementById( 'canvas' );
        document.body.appendChild( container );

        renderer = new THREE.WebGLRenderer({ alpha: true });
        container.appendChild( renderer.domElement );


        // set to cutout size in the future
        var width = divWidth;
        var height = divHeight;

        // enable shadows
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.BasicShadowMap;

        // initialize scene
        scene = new THREE.Scene();


        // initialize and position camera
         camera = new THREE.PerspectiveCamera( 45, width / height, 0.1, 100 );
        camera.position.set( 0, 0, 8 );

        // initialize and customize controls
        controls = new THREE.OrbitControls( camera, renderer.domElement );
        controls.minDistance = 2;
        controls.maxDistance = 5;
        controls.maxPolarAngle = 11*Math.PI/24;
        controls.enablePan = true;
        controls.enableDamping = true;
        controls.dampingFactor = 0.25;
        controls.target.x =  1;
        controls.enableZoom = true;

        // add ambient light
        scene.add( new THREE.AmbientLight( 0xffffff, .4 ) );

        // add point light
      /*  var light = new THREE.SpotLight( 0xffffff );
        //var light = new //THREE.HemisphereLight(0xffffff, 0x808020, 1);//PointLight(0xffffff);
        scene.add( light );
        light.position.set( -800, 800, 800 );
        light.rotation.set( -Math.PI / 4, 0, -Math.PI / 4 );


        light.intensity = 1.2;
        light.angle = Math.PI / 2;
        //light.position.y = 200;
        light.penumbra = 100;
        //light.rotation.z = -400;
        //light.position.x = -100;

        //light.shadow.mapSize.width = 512;  // default
        //light.shadow.mapSize.height = 512; // default
        light.shadow.camera.near = 0.5;       // default
        light.shadow.camera.far = 500;


        light.castShadow = true;
<<<<<<< Updated upstream
<<<<<<< HEAD
        var smapsize = 2048;
        light.shadow.mapSize.width = smapsize;
        light.shadow.mapSize.height = smapsize;

        var light = new THREE.DirectionalLight(0xffffff,1);
        light.position.set(50, 500, 22);
        light.target.position.set(300, 400, 200);
        var light = new THREE.DirectionalLight(0xffffff,1);
        light.position.set(0, 500, 200);
        light.target.position.set(0, 0, 0);
        light.shadow.mapSize.width = 1024*4;
        light.shadow.mapSize.height = 1024*4;
        light.castShadow = true;

        light.shadow.camera.near = 0;
        light.shadow.camera.far = 4000;
        light.shadow.camera.fov = 90;
        scene.add(light);


        //add the group of all models into the scene
        scene.add( group );

        /*
        *Model Loaders
        */

        /*
        *Main function to load in the school model.
        *path takes a string of the file path of the model (GLTF format)
        *position takes a Vector3 and sets the the model centered to that position
        *modelGroup takes a Group and makes it the top of the tree
        *Each mesh in the model is added to a group based on the scene that it is in
        *each scene is then added to modelGroup
        */
        var loader = new THREE.GLTFLoader();

        function loadCampus(path, position, modelGroup){
          loader.load( path, function ( gltf )
          {
            clips = gltf.animations;
            /*
            *Each Scene is named a 1 letter code for what building it represents
            *E.G. Weinberg is W, Nangaku is N
            */
            gltf.scenes.forEach(function (curScene){
              var sceneGroup = new THREE.Group();
              sceneGroup.name = curScene.name;
              var sceneLength = curScene.children.length;

              /*
              *Each mesh has a prefix indicating the building it is a part of and the floor
              *e.g. N2 means Nangaku second floor
              *Each room is named after its room number e.g. N203 or N204
              *Each non room mesh is named with its prefix and followed by part
              */
              for(var i = 0; i < sceneLength; i++){

                sceneGroup.add(curScene.children[0]);
              }
              sceneGroup.children.forEach( function (child){
                if (child instanceof THREE.Mesh){
                  child.receiveShadow = true;
                  child.castShadow = true;
                  //tests if the mesh is a room or just an aesthetic part
                  if(child.name.slice(3, -3) == 'part'){
                    //Adds custom object containing if it is a selectable room and if it is already animated and the name(s) of the room
                    child.userData = {alreadyUp:false, room:false};
                  }

                  else{
                    //Accesses a list of names and adds each one to the model
                    child.userData = {alreadyUp:false, room:true, names:findNames(child.name)};
                  }
                }
              });
              modelGroup.add(sceneGroup);
            });
          });
          modelGroup.position.copy(position);
        }

        // add Nangaku model
        loadCampus('models/Nangaku6.gltf', new THREE.Vector3(1,0,-1), group);

        // add and position floor

        var floorMaterial = new THREE.MeshPhongMaterial({color: 0x6d6d6d});
        var floorGeometry = new THREE.PlaneBufferGeometry(100, 100);

        var floorMaterial = new THREE.MeshLambertMaterial({color: 0xffffff, side: THREE.DoubleSide});
        var floorGeometry = new THREE.PlaneBufferGeometry(20, 20);

        var floorMesh = new THREE.Mesh(floorGeometry, floorMaterial);
        floorMesh.rotation.x -= Math.PI * 0.5;
        floorMesh.position.y = 0;
        floorMesh.receiveShadow = true;
        floorMesh.castShadow = true;
        scene.add(floorMesh);



        // initialize postprocessing
        composer = new THREE.EffectComposer( renderer );
        var renderPass = new THREE.RenderPass( scene, camera );
        composer.addPass( renderPass );
        outlinePass = new THREE.OutlinePass( new THREE.Vector2( divWidth, divHeight ), scene, camera );
        composer.addPass( outlinePass );

        // initialize antialiasing
        effectFXAA = new THREE.ShaderPass( THREE.FXAAShader );
        effectFXAA.uniforms[ 'resolution' ].value.set( 1 / divWidth, 1 / divHeight );
        effectFXAA.renderToScreen = true;
        composer.addPass( effectFXAA );

        // initialize event listeners
        window.addEventListener( 'resize', onWindowResize, false );
        window.addEventListener( 'mouseup', onTouchMove );
        window.addEventListener( 'touchend', onTouchMove );
        window.addEventListener( 'touchstart', onmesh);
        window.addEventListener( 'mousedown', onmesh);
        window.addEventListener( 'mousemove', stopstart);

        // variables for listener functions
        var clicked = true;
        var started = false;
        var lfclick = true;
        var prevobj = null;

        //function returns a room when given a name (e.g. n203, w315, Library)
        function findRoom(roomName){
          group.forEach(function(building){
            building.forEach(function(room){
              room.names.forEach(function(name){
                if(name == roomName){
                  return room;
                }
              })
            });
          });
          return null;
        }

        /*
        * Animation Functions
        */

        //given a name and am object plays an animation
        function playAnimation(rootObject, clipName){
          var action = mixer.clipAction( THREE.AnimationClip.findByName(clips, clipName), rootObject );
          action.play();
        }

        function stopAnimation(rootObject, clipName){
          var action = mixer.clipAction( THREE.AnimationClip.findByName(clips, clipName), rootObject );
          action.stop();
        }

        //plays animation on a object forwards or backwards stopping on last frame
        function playFloorAnimation( rootObject, isUp, clipName ){

          var action = mixer.clipAction( THREE.AnimationClip.findByName(clips, clipName), rootObject );

          action.clampWhenFinished = true;
          action.setLoop(THREE.LoopOnce);

          if(isUp){
            action.timeScale = -1;
          }

          else{action.timeScale = 1;}
          rootObject.alreadyUp = !rootObject.alreadyUp;
          action.play();
          action.paused = false;
        }

        function lowerFloor(rootObject, clipName){
          var action = mixer.clipAction( THREE.AnimationClip.findByName(clips, clipName), rootObject );
          action.timeScale = -1;
          action.clampWhenFinished = true;
          action.paused = false;
          action.play();
          rootObject.alreadyUp =  false;
          action.setLoop(THREE.LoopOnce);
        }

        function raiseFloor(rootObject, clipName){
          var action = mixer.clipAction( THREE.AnimationClip.findByName(clips, clipName), rootObject );
          action.timeScale = 1;
          rootObject.alreadyUp =  true;
          action.setLoop(THREE.LoopOnce);
          action.clampWhenFinished = true;
          action.play();
          action.paused = false;
        }

        /*
        *Animates all floors in the building Group
        *putting 'pingPong' for animation mode toggles the animation Up and down
        * 'lower' only lowers the floors if they are up
        *'raise' raises the floors if they are dowb.
        */

        function animateFloors(selectedRoom, animationMode){
          if(animationMode  == 'PingPong'){
            selectedRoom.parent.children.forEach(function(child){
              //plays animations by the name of the floors, each floor's suffix has a matching animation
              if (THREE.AnimationClip.findByName(clips,child.name.slice(0, -3)) != null){
                playFloorAnimation(child, child.alreadyUp, child.name.slice(0, -3));
              }
              else{child.alreadyUp = !child.alreadyUp;}
            });
          }

          else if(animationMode == 'Lower'){
            selectedRoom.parent.children.forEach(function(child){
              //plays animations by the name of the floors, each floor's suffix has a matching animation
              if (THREE.AnimationClip.findByName(clips,child.name.slice(0, -3)) != null){
                lowerFloor(child, child.name.slice(0, -3));
              }
              else {child.alreadyUp =  false}
            });
          }

          else if (animationMode == 'Raise') {
            selectedRoom.parent.children.forEach(function(child){
              //plays animations by the name of the floors, each floor's suffix has a matching animation e.g. Nangaku second floor is N2
              if (THREE.AnimationClip.findByName(clips,child.name.slice(0, -3)) != null){
                raiseFloor(child, child.name.slice(0, -3));
              }
              else {child.alreadyUp =  true}
            });
          }
          else {console.log("Invalid Input, use pingPong, raise, or lower")}
        }

        /////////////////////////////////
        //  event triggered functions  //
        /////////////////////////////////

        function stopstart (event)
        {
          if (!lfclick)
          {
            controls.enableRotate = false;
            controls.enablePan = true;
            console.log("a");
          }
          else
          {
            controls.enableRotate = true;
            //controls.enablePan = false;
            //console.log("b");
          }
        }

        function onmesh (event)
        {
          var x, y;

          if (event.button == 2)
          {
            lfclick = false;
          }
          else
          {
            lfclick = true;
          }

          if ( event.changedTouches )
          {
            x = event.changedTouches[ 0 ].pageX;
            y = event.changedTouches[ 0 ].pageY;
          }
          else
          {
            x = event.clientX;
            y = event.clientY;
          }
          mouse.x = ( ( x - renderer.domElement.offsetLeft ) / renderer.domElement.clientWidth ) * 2 - 1;
          mouse.y = - ( ( y - renderer.domElement.offsetTop ) / renderer.domElement.clientHeight ) * 2 + 1;

          raycaster.setFromCamera( mouse, camera );
          var intersects = raycaster.intersectObjects( [ group ], true );
          if ( intersects.length > 0 )
          {
            started = true;
          }
          else
          {
            started = false;
          }

          // put opennav where

        }

        //

        function onTouchMove( event )
        {
          var x, y;
          if ( event.changedTouches )
          {
            x = event.changedTouches[ 0 ].pageX;
            y = event.changedTouches[ 0 ].pageY;
          }
          else
          {
            x = event.clientX;
            y = event.clientY;
          }
          mouse.x = ( ( x - renderer.domElement.offsetLeft ) / renderer.domElement.clientWidth ) * 2 - 1;
          mouse.y = - ( ( y - renderer.domElement.offsetTop ) / renderer.domElement.clientHeight ) * 2 + 1;
          checkIntersection();
        }

        //
        function addSelectedObject( object )
        {
          selectedObjects = [];
          selectedObjects.push( object );
        }

        //
        function checkIntersection()
        {
          raycaster.setFromCamera( mouse, camera );
          var intersects = raycaster.intersectObjects( [ group ], true );
          if ( intersects.length > 0 )
          {
            outlinePass.selectedObjects = [];

            var selectedObject = intersects[ 0 ].object;
            animateFloors(selectedObject, 'PingPong');

            addSelectedObject( selectedObject );
            if (clicked && started || prevobj != selectedObject)
            {
              outlinePass.selectedObjects = selectedObjects;
              openNav();
            }
            else
            {
              outlinePass.selectedObjects = [];
              closeNav();
            }
            clicked = !clicked;
          }
          else
          {
            if (!started)
            {
              outlinePass.selectedObjects = [];
            }
          }
          prevobj = selectedObject;
        }

        var width = divWidth;
        var height = divHeight;
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
        renderer.setSize( width, height );
        composer.setSize( width, height );
        renderer.domElement.style.width = width + 'px';
        renderer.domElement.style.height = height + 'px';
      }

          // resize the screen correctly
          var i = 0;
          function onWindowResize()
          {
            divWidth = window.innerWidth;// / 2;
            divHeight = window.innerHeight; // 2;
            var width = divWidth;
            var height = divHeight;
            var w2 = 0;//200/7;//= xx;
            var h2 = 0;//= yy;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize( width, height );
            composer.setSize( width, height );
            renderer.domElement.style.width = width + 'px';
            renderer.domElement.style.height = height + 'px';
            //renderer.domElement.style.offsetLeft = w2 + 'px';
            //renderer.domElement.style.offsetTop = h2 + 'px';
            effectFXAA.uniforms[ 'resolution' ].value.set( 1 / divWidth, 1 / divHeight );


            var css = '#canvas {background-color: #f0f; margin-left: ' + w2.toString() + 'vw; width: 0px; height: 0px; padding: 0px; margin-top: ' + h2.toString() + 'vw; position: static;}',
            head = document.head || document.getElementsByTagName('head')[0],
            style = document.createElement('style');

            var y;


            style.type = 'text/css';
            if (style.styleSheet)
            {
              // This is required for IE8 and below.
              style.styleSheet.cssText = css;
            }
            else
            {
              t = document.createTextNode(css);
              style.appendChild(t);

              if (style.childNodes.length <1)
              {
                //y = style.childNode[0];
                style.removeChild(style.childNode[style.childNodes.length - 1]);
                head.style.childNodes[0].kill();
                head.style.childNodes[i].kill();
                style.removeChild(style.childNode[0]);
                head.style.childNodes[i-1].kill();
                style.removeChild(style.childNode[i]);
                style.removeChild(style.childNode[i-1]);
                head.style.childNodes[style.childNodes.length - 1].kill();
                //console.log(style.childNodes.length);

                i++;
              }

              console.log(style.childNodes.length);

              //head.style.textContent = css;
            }

            head.appendChild(style);

            if (head.childNodes.length > 1)
            {
              //y = style.childNodes[0];
              //head.removeChild(y);
            }
          }

          // variables needed before draw loop
          var panx = 1;
          var panz = 1;

          // draw loop
          function animate()
          {

            requestAnimationFrame( animate );
            //stats.begin();
            var timer = performance.now();

            if (controls.target.x > panx) {
                controls.target.x = panx;
            }

            if (controls.target.x < -1 * panx) {
                controls.target.x = -1 * panx;
            }
            if (controls.target.z > panz) {
                controls.target.z = panz;
            }
            if (controls.target.z < -1 * panz) {
                controls.target.z = -1 * panz;
            }
            controls.target.y = 0;

            controls.update();
            composer.render();
            //stats.end();
            mixer.update(clock.getDelta());
          }

        </script>

    </body>

</html>
